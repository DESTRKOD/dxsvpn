<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>DxS VPN ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Google Sans', system-ui, sans-serif;
      background: linear-gradient(135deg, #f0f4ff 0%, #e6ecff 100%);
      color: #0f1a3a;
      height: 100vh;
      overflow: hidden;
      touch-action: manipulation;
    }
    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px 16px 24px;
    }
    .lottie-container {
      width: 200px;
      height: 200px;
      margin-bottom: 24px;
      filter: drop-shadow(0 8px 24px rgba(26,115,232,0.24));
    }
    h1 {
      font-size: 26px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 28px;
      line-height: 1.3;
    }
    .input-group {
      width: 100%;
      max-width: 380px;
      margin-bottom: 16px;
    }
    .phone-row {
      display: flex;
      gap: 0;
      align-items: stretch;
      border: 2px solid #d2e0ff;
      border-radius: 14px;
      overflow: hidden;
      background: white;
    }
    .phone-row:focus-within {
      border-color: #4285f4;
      box-shadow: 0 0 0 3px rgba(66,133,244,0.12);
    }
    .country-select-wrapper {
      position: relative;
      flex: 0 0 92px;
      border-right: 1px solid #d2e0ff;
    }
    .country-select {
      appearance: none;
      border: none;
      border-radius: 0;
      padding: 14px 28px 14px 12px;
      font-size: 17px;
      background: transparent;
      cursor: pointer;
      height: 100%;
      width: 100%;
    }
    .flag {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      pointer-events: none;
    }
    .number-input {
      flex: 1;
      border: none;
      border-radius: 0;
      font-size: 17px;
      padding: 14px 16px;
      outline: none;
      height: 100%;
    }
    input[type="tel"]::-webkit-outer-spin-button,
    input[type="tel"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input, select {
      width: 100%;
      padding: 14px 16px;
      font-size: 17px;
      border: 2px solid #d2e0ff;
      border-radius: 14px;
      background: white;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      border-color: #4285f4;
      box-shadow: 0 0 0 3px rgba(66,133,244,0.12);
    }
    .btn {
      width: 100%;
      max-width: 380px;
      padding: 16px;
      font-size: 18px;
      font-weight: 600;
      color: white;
      background: linear-gradient(145deg, #4285f4, #1967d2);
      border: none;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(66,133,244,0.3);
      cursor: pointer;
      transition: all 0.24s;
      margin-top: 8px;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 32px rgba(66,133,244,0.4); }
    .btn:active  { transform: scale(0.98); }
    .btn:disabled { opacity: 0.55; transform: none; box-shadow: none; cursor: not-allowed; }
    .message {
      font-size: 15px;
      text-align: center;
      margin-top: 16px;
      line-height: 1.4;
      opacity: 0;
      transition: opacity 0.3s;
      white-space: pre-line;
    }
    .message.visible { opacity: 1; }
    .message.success { color: #188038; }
    .message.error { color: #d93025; }
    #successBlock { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
    @media (min-width: 420px) {
      .lottie-container { width: 220px; height: 220px; margin-bottom: 32px; }
      h1 { font-size: 28px; }
      .btn { padding: 17px; font-size: 19px; }
      .country-select-wrapper { flex: 0 0 110px; }
    }
    @media (max-width: 360px) {
      .country-select-wrapper { flex: 0 0 88px; }
      .country-select { padding-right: 24px; font-size: 16px; }
      .flag { right: 6px; font-size: 18px; }
    }
  </style>
</head>
<body>

<div class="container">
  <div id="formBlock">
    <div class="lottie-container">
      <lottie-player src="./registration.json" background="transparent" speed="0.9" loop autoplay></lottie-player>
    </div>

    <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>

    <div class="input-group">
      <input type="text" id="name" placeholder="–ò–º—è" autocomplete="name" />
    </div>

    <div class="input-group">
      <div class="phone-row">
        <div class="country-select-wrapper">
          <select class="country-select" id="countryCode">
            <option value="+7" data-flag="üá∑üá∫" selected>+7</option>
            <option value="+1" data-flag="üá∫üá∏">+1</option>
            <option value="+44" data-flag="üá¨üáß">+44</option>
            <option value="+49" data-flag="üá©üá™">+49</option>
            <option value="+33" data-flag="üá´üá∑">+33</option>
            <option value="+375" data-flag="üáßüáæ">+375</option>
            <option value="+380" data-flag="üá∫üá¶">+380</option>
            <option value="+371" data-flag="üá±üáª">+371</option>
            <option value="+370" data-flag="üá±üáπ">+370</option>
            <option value="+372" data-flag="üá™üá™">+372</option>
            <option value="+995" data-flag="üá¨üá™">+995</option>
            <option value="+994" data-flag="üá¶üáø">+994</option>
            <option value="+374" data-flag="üá¶üá≤">+374</option>
            <option value="+373" data-flag="üá≤üá©">+373</option>
          </select>
          <span class="flag" id="selectedFlag">üá∑üá∫</span>
        </div>
        <input type="tel" id="phoneNumber" class="number-input" placeholder="9991234567" inputmode="numeric" pattern="[0-9]*" autocomplete="tel-national" />
      </div>
    </div>

    <div class="input-group">
      <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="new-password" />
    </div>

    <div class="input-group">
      <input type="password" id="passwordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="new-password" />
    </div>

    <button class="btn" id="submitBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>

    <div class="message" id="statusMsg"></div>
  </div>

  <div id="successBlock" style="display: none;">
    <div class="lottie-container">
      <lottie-player src="./welcome.json" background="transparent" speed="0.9" loop autoplay></lottie-player>
    </div>
    <h1>–ì–æ—Ç–æ–≤–æ!</h1>
    <div class="message success visible">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞</div>
    <button class="btn" id="goToLoginBtn" style="margin-top: 28px;">–í–æ–π—Ç–∏</button>
  </div>
</div>

<script>
  const nameInput = document.getElementById('name');
  const countrySelect = document.getElementById('countryCode');
  const selectedFlag = document.getElementById('selectedFlag');
  const phoneNumber = document.getElementById('phoneNumber');
  const passwordInput = document.getElementById('password');
  const passwordConfirm = document.getElementById('passwordConfirm');
  const submitBtn = document.getElementById('submitBtn');
  const statusMsg = document.getElementById('statusMsg');
  const formBlock = document.getElementById('formBlock');
  const successBlock = document.getElementById('successBlock');
  const goToLoginBtn = document.getElementById('goToLoginBtn');

  countrySelect.addEventListener('change', () => {
    const selectedOption = countrySelect.options[countrySelect.selectedIndex];
    selectedFlag.textContent = selectedOption.dataset.flag || 'üåç';
  });

  phoneNumber.addEventListener('input', e => {
    e.target.value = e.target.value.replace(/\D/g, '');
  });

  function showStatus(text, isError = false) {
    statusMsg.textContent = text;
    statusMsg.style.color = isError ? '#d93025' : '#0f1a3a';
    statusMsg.classList.add('visible');
  }

  function hideStatus() {
    statusMsg.classList.remove('visible');
    statusMsg.textContent = '';
  }

  function triggerFeedback(style = 'light') {
    if (window.Telegram?.WebApp?.HapticFeedback) {
      try {
        window.Telegram.WebApp.HapticFeedback.impactOccurred(style);
      } catch {}
    }
  }

  function getFullPhone() {
    return countrySelect.value + phoneNumber.value.trim();
  }

  function handleSubmit() {
    const name = nameInput.value.trim();
    const numPart = phoneNumber.value.trim();
    const fullPhone = getFullPhone();
    const password = passwordInput.value.trim();
    const confirm = passwordConfirm.value.trim();

    if (name.length < 2) {
      showStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)', true);
      triggerFeedback('medium');
      return;
    }

    if (numPart.length < 9) {
      showStatus('–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π', true);
      triggerFeedback('medium');
      return;
    }

    if (password.length < 6) {
      showStatus('–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', true);
      triggerFeedback('medium');
      return;
    }

    if (password !== confirm) {
      showStatus('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', true);
      triggerFeedback('medium');
      return;
    }

    hideStatus();
    submitBtn.disabled = true;
    submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

    const payload = {
      action: 'register',
      name: name,
      phone: fullPhone,
      password: password
    };

    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.sendData(JSON.stringify(payload));
      triggerFeedback('heavy');
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Telegram.WebApp
    setTimeout(() => {
      formBlock.style.display = 'none';
      successBlock.style.display = 'flex';
    }, 700);
  }

  submitBtn.addEventListener('click', handleSubmit);

  goToLoginBtn.addEventListener('click', () => {
    triggerFeedback('light');
    setTimeout(() => {
      window.location.href = 'regorlog.html';
    }, 180);
  });

  if (window.Telegram?.WebApp) {
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.MainButton.setText('–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø');
    tg.MainButton.show();
    tg.MainButton.onClick(handleSubmit);
  }

  nameInput.focus();
</script>
</body>
</html>